/*
 * Copyright 2018 Maxime Louet
 *
 * GitHub repository: https://github.com/maximelouet/blih-web
 */

(function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.VanillaModal=c.exports}})(this,function(a){"use strict";function b(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function c(s){console.error("VanillaModal: "+s)}function d(s,t){return function(u){var v=s.filter(t);return v[0]?v[0][u]:void 0}}function f(){var s=document.createElement("div");return d([{key:"transition",value:"transitionend"},{key:"OTransition",value:"otransitionend"},{key:"MozTransition",value:"transitionend"},{key:"WebkitTransition",value:"webkitTransitionEnd"}],function(u){var v=u.key;return"undefined"!=typeof s.style[v]})("value")}function g(s){return"[object Array]"===Object.prototype.toString.call(s)&&s.length}function h(s,t){var u=t||document,v=u.querySelector(s);return v||c(s+" not found in document."),v}function j(s,t){s instanceof HTMLElement||c("Not a valid HTML element."),s.setAttribute("class",s.className.split(" ").filter(function(u){return u!==t}).concat(t).join(" "))}function k(s,t){s instanceof HTMLElement||c("Not a valid HTML element."),s.setAttribute("class",s.className.split(" ").filter(function(u){return u!==t}).join(" "))}function l(s){return s&&"string"==typeof s.hash?document.querySelector(s.hash):"string"==typeof s?document.querySelector(s):(c("No selector supplied to open()"),null)}function m(s){return p({},q,s,{transitionEnd:f()})}function n(s,t){for(var w,u=(s.target.document||s.target.ownerDocument).querySelectorAll(t),v=0;v<u.length;v+=1)for(w=s.target;w&&w!==document.body;){if(w===u[v])return w;w=w.parentNode}return null}Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function s(t,u){for(var w,v=0;v<u.length;v++)w=u[v],w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(t,w.key,w)}return function(t,u,v){return u&&s(t.prototype,u),v&&s(t,v),t}}(),p=Object.assign||function(s){for(var u,t=1;t<arguments.length;t++)for(var v in u=arguments[t],u)Object.prototype.hasOwnProperty.call(u,v)&&(s[v]=u[v]);return s},q={modal:".modal",modalInner:".modal-inner",modalContent:".modal-content",open:"[data-modal-open]",close:"[data-modal-close]",page:"body",class:"modal-visible",loadClass:"vanilla-modal",clickOutside:!0,closeKeys:[27],transitions:!0,transitionEnd:null,onBeforeOpen:null,onBeforeClose:null,onOpen:null,onClose:null},r=function(){function s(t){b(this,s),this.isOpen=!1,this.current=null,this.isListening=!1,this.settings=m(t),this.dom=this.getDomNodes(),this.open=this.open.bind(this),this.close=this.close.bind(this),this.closeKeyHandler=this.closeKeyHandler.bind(this),this.outsideClickHandler=this.outsideClickHandler.bind(this),this.delegateOpen=this.delegateOpen.bind(this),this.delegateClose=this.delegateClose.bind(this),this.listen=this.listen.bind(this),this.destroy=this.destroy.bind(this),this.addLoadedCssClass(),this.listen()}return o(s,[{key:"getDomNodes",value:function(){var u=this.settings,v=u.modal,w=u.page,x=u.modalInner,y=u.modalContent;return{modal:h(v),page:h(w),modalInner:h(x,h(v)),modalContent:h(y,h(v))}}},{key:"addLoadedCssClass",value:function(){j(this.dom.page,this.settings.loadClass)}},{key:"setOpenId",value:function(u){var v=this.dom.page;v.setAttribute("data-current-modal",u||"anonymous")}},{key:"removeOpenId",value:function(){var u=this.dom.page;u.removeAttribute("data-current-modal")}},{key:"open",value:function(u,v){var w=this.dom.page,x=this.settings,y=x.onBeforeOpen,z=x.onOpen;return this.closeModal(v),!1==this.current instanceof HTMLElement?void(this.releaseNode(this.current),this.current=l(u),"function"==typeof y&&y.call(this,v),this.captureNode(this.current),j(w,this.settings.class),this.setOpenId(this.current.id),this.isOpen=!0,"function"==typeof z&&z.call(this,v)):void c("VanillaModal target must exist on page.")}},{key:"detectTransition",value:function(){var u=this.dom.modal,v=window.getComputedStyle(u,null);return!!["transitionDuration","oTransitionDuration","MozTransitionDuration","webkitTransitionDuration"].filter(function(w){return"string"==typeof v[w]&&0<parseFloat(v[w])}).length}},{key:"close",value:function(u){var v=this.settings,w=v.transitions,x=v.transitionEnd,y=v.onBeforeClose,z=this.detectTransition();this.isOpen&&(this.isOpen=!1,"function"==typeof y&&y.call(this,u),k(this.dom.page,this.settings.class),w&&x&&z?this.closeModalWithTransition(u):this.closeModal(u))}},{key:"closeModal",value:function(u){var v=this.settings.onClose;this.removeOpenId(this.dom.page),this.releaseNode(this.current),this.isOpen=!1,this.current=null,"function"==typeof v&&v.call(this,u)}},{key:"closeModalWithTransition",value:function(u){var v=this,w=this.dom.modal,x=this.settings.transitionEnd;w.addEventListener(x,function z(){w.removeEventListener(x,z),v.closeModal(u)})}},{key:"captureNode",value:function(u){for(var v=this.dom.modalContent;u.childNodes.length;)v.appendChild(u.childNodes[0])}},{key:"releaseNode",value:function(u){for(var v=this.dom.modalContent;v.childNodes.length;)u.appendChild(v.childNodes[0])}},{key:"closeKeyHandler",value:function(u){var v=this.settings.closeKeys;g(v)&&-1<v.indexOf(u.which)&&!0===this.isOpen&&(u.preventDefault(),this.close(u))}},{key:"outsideClickHandler",value:function(u){var v=this.settings.clickOutside,w=this.dom.modalInner;if(v){for(var x=u.target;x&&x!==document.body;){if(x===w)return;x=x.parentNode}this.close(u)}}},{key:"delegateOpen",value:function(u){var v=this.settings.open,w=n(u,v);w&&(u.preventDefault(),this.open(w,u))}},{key:"delegateClose",value:function(u){var v=this.settings.close;n(u,v)&&(u.preventDefault(),this.close(u))}},{key:"listen",value:function(){var u=this.dom.modal;this.isListening?c("Event listeners already applied."):(u.addEventListener("click",this.outsideClickHandler,!1),document.addEventListener("keydown",this.closeKeyHandler,!1),document.addEventListener("click",this.delegateOpen,!1),document.addEventListener("click",this.delegateClose,!1),this.isListening=!0)}},{key:"destroy",value:function(){var u=this.dom.modal;this.isListening?(this.close(),u.removeEventListener("click",this.outsideClickHandler),document.removeEventListener("keydown",this.closeKeyHandler),document.removeEventListener("click",this.delegateOpen),document.removeEventListener("click",this.delegateClose),this.isListening=!1):c("Event listeners already removed.")}}]),s}();a.default=r});
